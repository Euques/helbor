<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-5">
      <h2 class="text-center">Login</h2>
      <div id="status" class="mt-3"></div>
      <button id="loginButton" class="btn btn-primary w-100 mt-4">
        Login com Google
      </button>
    </div>

    <!-- Firebase Scripts -->
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js'
      import {
        getAuth,
        signInWithPopup,
        GoogleAuthProvider
      } from 'https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js'
      import {
        getFirestore,
        doc,
        setDoc
      } from 'https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js'
      import { getStorage } from 'https://www.gstatic.com/firebasejs/11.0.2/firebase-storage.js'

      // Configuração Firebase
      const firebaseConfig = {
        apiKey: 'AIzaSyB8-03eq_8LCMfcxuY-Z4eCVWV32Ad4lfQ',
        authDomain: 'feira-265d4.firebaseapp.com',
        projectId: 'feira-265d4',
        storageBucket: 'feira-265d4.appspot.com',
        messagingSenderId: '124883888377',
        appId: '1:124883888377:web:63262744266bf5186a5a28',
        measurementId: 'G-P5BDCBNMHE'
      }
      const app = initializeApp(firebaseConfig)
      const auth = getAuth(app)
      const db = getFirestore(app)
      const storage = getStorage(app)

      // Referência ao botão de login
      const loginButton = document.getElementById('loginButton')

      // Função para fazer login com o Google
      loginButton.addEventListener('click', async () => {
        const provider = new GoogleAuthProvider()
        try {
          // Fazendo o login
          const result = await signInWithPopup(auth, provider)
          const user = result.user

          // Salvar dados no Firestore (caso ainda não tenha sido feito)
          const userRef = doc(db, 'users', user.uid)
          await setDoc(
            userRef,
            {
              email: user.email,
              displayName: user.displayName,
              photoURL: user.photoURL
            },
            { merge: true }
          )

          // Redirecionar para a página do expositor com o UID
          window.location.href = `/user/?u=${user.uid}`
        } catch (error) {
          console.error('Erro ao fazer login:', error)
          document.getElementById(
            'status'
          ).innerHTML = `<div class="alert alert-danger">Erro ao fazer login: ${error.message}</div>`
        }
      })
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
