<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Produtos do Expositor</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      /* Estilo permanece o mesmo (do código anterior) */
      body {
        background-color: #f7f7f7;
        font-family: 'Arial', sans-serif;
      }

      .product-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .product-item {
        display: flex;
        justify-content: space-between;
        background-color: #fff;
        margin-bottom: 10px;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        max-height: 200px;
      }

      .product-item img {
        width: 150px;
        height: 150px;
        object-fit: cover;
        flex-shrink: 0;
      }

      .product-info {
        flex: 1;
        padding: 10px;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .product-name {
        font-size: 1.2rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
      }

      .product-actions {
        display: flex;
        gap: 10px;
      }

      .product-actions button {
        padding: 5px 10px;
        font-size: 0.9rem;
      }
    </style>
  </head>
  <body>
    <div class="container mt-4">
      <h2 class="text-center mb-4">Produtos do Expositor</h2>
      <ul id="productsContainer" class="product-list"></ul>
    </div>

    <!-- Firebase Scripts -->
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js'
      import {
        getFirestore,
        collection,
        addDoc,
        updateDoc,
        deleteDoc,
        doc,
        onSnapshot
      } from 'https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js'

      const firebaseConfig = {
        apiKey: 'AIzaSyB8-03eq_8LCMfcxuY-Z4eCVWV32Ad4lfQ',
        authDomain: 'feira-265d4.firebaseapp.com',
        databaseURL: 'https://feira-265d4-default-rtdb.firebaseio.com',
        projectId: 'feira-265d4',
        storageBucket: 'feira-265d4.firebasestorage.app',
        messagingSenderId: '124883888377',
        appId: '1:124883888377:web:c4e8c834b313127f6a5a28',
        measurementId: 'G-2QFQD5NGXR'
      }

      const app = initializeApp(firebaseConfig)
      const db = getFirestore(app)

      const params = new URLSearchParams(window.location.search)
      const uid = params.get('ex')

      if (!uid) {
        alert('Erro: UID não encontrado na URL.')
        throw new Error('UID não encontrado na URL.')
      }

      const productsContainer = document.getElementById('productsContainer')

      // Função para atualizar lista de produtos em tempo real
      const loadProducts = () => {
        const productsRef = collection(db, 'users', uid, 'products')
        onSnapshot(productsRef, (snapshot) => {
          productsContainer.innerHTML = '' // Limpar lista de produtos

          snapshot.forEach((doc) => {
            const data = doc.data()
            const productId = doc.id

            const productItem = document.createElement('li')
            productItem.classList.add('product-item')

            productItem.innerHTML = `
              <img src="${data.imageURL}" alt="${data.name}" />
              <div class="product-info">
                <div class="product-name">${data.name}</div>
                <div class="product-description">${data.description}</div>
                <div class="product-price">${data.price}</div>
              </div>
              <div class="product-actions">
                <button class="btn btn-primary btn-sm edit-btn" data-id="${productId}">Editar</button>
                <button class="btn btn-danger btn-sm delete-btn" data-id="${productId}">Excluir</button>
              </div>
            `

            productsContainer.appendChild(productItem)
          })

          // Adicionar eventos para os botões após criar os elementos
          addProductActions()
        })
      }

      // Adicionar eventos aos botões de editar e excluir
      const addProductActions = () => {
        const editButtons = document.querySelectorAll('.edit-btn')
        const deleteButtons = document.querySelectorAll('.delete-btn')

        editButtons.forEach((button) => {
          button.addEventListener('click', (e) => {
            const productId = e.target.dataset.id
            // Lógica de edição (atualizar produto)
            editProduct(productId)
          })
        })

        deleteButtons.forEach((button) => {
          button.addEventListener('click', (e) => {
            const productId = e.target.dataset.id
            // Lógica de exclusão (com confirmação)
            deleteProduct(productId)
          })
        })
      }

      // Função para editar produto
      const editProduct = async (productId) => {
        const newName = prompt('Digite o novo nome do produto:')
        const newPrice = prompt('Digite o novo preço:')
        const newDescription = prompt('Digite a nova descrição:')

        if (newName && newPrice && newDescription) {
          try {
            const productRef = doc(db, 'users', uid, 'products', productId)
            await updateDoc(productRef, {
              name: newName,
              price: newPrice,
              description: newDescription
            })
            alert('Produto atualizado com sucesso!')
          } catch (error) {
            console.error('Erro ao atualizar produto:', error)
          }
        } else {
          alert('Edição cancelada ou informações incompletas.')
        }
      }

      // Função para excluir produto
      const deleteProduct = async (productId) => {
        const confirmDelete = confirm('Tem certeza de que deseja excluir este produto?')

        if (confirmDelete) {
          try {
            const productRef = doc(db, 'users', uid, 'products', productId)
            await deleteDoc(productRef)
            alert('Produto excluído com sucesso!')
          } catch (error) {
            console.error('Erro ao excluir produto:', error)
          }
        }
      }

      // Inicializar a carga dos produtos
      loadProducts()
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
