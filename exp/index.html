<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Produtos do Expositor</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      /* Customização de estilo */
      body {
        background-color: #f7f7f7;
        font-family: 'Arial', sans-serif;
      }

      .product-card {
        display: flex;
        flex-direction: column;
        margin-bottom: 20px;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        background-color: #fff;
        transition: transform 0.3s ease;
        height: 100%;
        max-width: 300px;
      }

      .product-card:hover {
        transform: translateY(-10px);
      }

      .product-card .image-container {
        width: 100%;
        height: 200px;
        background-size: cover;
        background-position: center;
        border-radius: 10px 10px 0 0;
      }

      .product-card .card-body {
        padding: 20px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        height: 100%;
      }

      .product-card .card-body h5 {
        font-size: 1.25rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 15px;
      }

      .product-card .card-body p {
        font-size: 1rem;
        color: #555;
        margin-bottom: 15px;
        line-height: 1.5;
      }

      .product-price {
        font-size: 1.2rem;
        font-weight: bold;
        color: #2d6a4f;
        margin-top: 10px;
      }

      .product-card .btn {
        background-color: #2d6a4f;
        color: #fff;
        border: none;
        padding: 10px;
        border-radius: 5px;
        text-transform: uppercase;
        font-weight: bold;
        transition: background-color 0.3s ease;
      }

      .product-card .btn:hover {
        background-color: #218c46;
      }

      /* Responsividade */
      @media (max-width: 768px) {
        .product-card {
          max-width: 100%;
        }

        .product-card .card-body {
          padding: 15px;
        }
      }

      .container {
        margin-top: 50px;
      }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <h2 class="text-center mb-4">Produtos do Expositor</h2>

      <!-- Card do Expositor -->
      <div id="expositorCard" class="card mb-4" style="max-width: 18rem;">
        <img
          id="expositorLogo"
          class="card-img-top"
          alt="Logo do Expositor"
          style="height: 150px; object-fit: cover; border-radius: 50%;"
        />
        <div class="card-body">
          <h5 id="expositorName" class="card-title"></h5>
          <p id="expositorDescription" class="card-text"></p>
        </div>
      </div>

      <div id="productsContainer" class="row row-cols-1 row-cols-md-3 g-4">
        <!-- Produtos serão inseridos aqui -->
      </div>
    </div>

    <!-- Firebase Scripts -->
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js'
      import {
        getFirestore,
        doc,
        getDoc,
        getDocs,
        collection
      } from 'https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js'

      // Configuração Firebase
      const firebaseConfig = {
        apiKey: 'AIzaSyB8-03eq_8LCMfcxuY-Z4eCVWV32Ad4lfQ',
        authDomain: 'feira-265d4.firebaseapp.com',
        databaseURL: 'https://feira-265d4-default-rtdb.firebaseio.com',
        projectId: 'feira-265d4',
        storageBucket: 'feira-265d4.firebasestorage.app',
        messagingSenderId: '124883888377',
        appId: '1:124883888377:web:c4e8c834b313127f6a5a28',
        measurementId: 'G-2QFQD5NGXR'
      }

      const app = initializeApp(firebaseConfig)
      const db = getFirestore(app)

      const params = new URLSearchParams(window.location.search)
      const uid = params.get('ex')
      const statusDiv = document.getElementById('status')

      if (!uid) {
        statusDiv.innerHTML =
          '<div class="alert alert-danger">Erro: UID não encontrado na URL.</div>'
        throw new Error('UID não encontrado na URL.')
      }

      // Carregar expositor e exibir dados no card
      async function loadExpositor() {
        try {
          const docRef = doc(db, 'users', uid)
          const docSnap = await getDoc(docRef)

          if (docSnap.exists()) {
            const data = docSnap.data()
            document.getElementById('expositorName').textContent = data.name || ''
            document.getElementById('expositorDescription').textContent =
              data.description || ''

            // Exibir logo do expositor
            if (data.logoURL) {
              const logoPreview = document.getElementById('expositorLogo')
              logoPreview.src = data.logoURL
            }
          } else {
            statusDiv.innerHTML =
              '<div class="alert alert-warning">Expositor não encontrado.</div>'
          }
        } catch (error) {
          console.error('Erro ao carregar expositor:', error)
          statusDiv.innerHTML =
            '<div class="alert alert-danger">Erro ao carregar dados do expositor.</div>'
        }
      }

      // Carregar produtos do expositor e exibir em cards
      async function loadProducts() {
        try {
          const querySnapshot = await getDocs(
            collection(db, 'users', uid, 'products')
          )
          const productsContainer = document.getElementById('productsContainer')
          productsContainer.innerHTML = '' // Limpar lista de produtos

          querySnapshot.forEach((doc) => {
            const data = doc.data()

            const productCard = document.createElement('div')
            productCard.classList.add('col')

            productCard.innerHTML = `
              <div class="product-card">
                <div class="image-container" style="background-image: url('${data.imageURL}');"></div>
                <div class="card-body">
                  <h5 class="card-title">${data.name}</h5>
                  <p class="card-text">${data.description}</p>
                  <p class="product-price">${data.price}</p>
                  <button class="btn">Comprar</button>
                </div>
              </div>
            `

            productsContainer.appendChild(productCard)
          })
        } catch (error) {
          console.error('Erro ao carregar produtos:', error)
          statusDiv.innerHTML =
            '<div class="alert alert-danger">Erro ao carregar os produtos.</div>'
        }
      }

      // Carregar expositor e produtos ao iniciar
      loadExpositor()
      loadProducts()
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
