<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Produtos Disponíveis</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .product-card {
        border: 1px solid #ddd;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      .product-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 8px 12px rgba(0, 0, 0, 0.2);
      }
      .product-card img {
        height: 200px;
        object-fit: cover;
        width: 100%;
      }
      .product-details {
        padding: 15px;
      }
      .product-price {
        color: #28a745;
        font-size: 1.2rem;
        font-weight: bold;
      }
      .product-title {
        font-size: 1.25rem;
        font-weight: bold;
      }
      .product-description {
        font-size: 0.9rem;
        color: #555;
      }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <h2 class="text-center mb-4">Produtos Disponíveis</h2>
      <div id="productsContainer" class="row">
        <!-- Produtos serão carregados aqui -->
      </div>
    </div>

    <!-- Firebase Scripts -->
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js'
      import {
        getFirestore,
        collection,
        query,
        where,
        getDocs
      } from 'https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js'

      // Configuração do Firebase
      const firebaseConfig = {
        apiKey: 'AIzaSyB8-03eq_8LCMfcxuY-Z4eCVWV32Ad4lfQ',
        authDomain: 'feira-265d4.firebaseapp.com',
        databaseURL: 'https://feira-265d4-default-rtdb.firebaseio.com',
        projectId: 'feira-265d4',
        storageBucket: 'feira-265d4.firebasestorage.app',
        messagingSenderId: '124883888377',
        appId: '1:124883888377:web:c4e8c834b313127f6a5a28',
        measurementId: 'G-2QFQD5NGXR'
      }

      const app = initializeApp(firebaseConfig)
      const db = getFirestore(app)

      // Função para recuperar o UID da URL
      function getUIDFromURL() {
        const urlParams = new URLSearchParams(window.location.search)
        return urlParams.get('uid')
      }

      // Carregar produtos do produtor específico
      async function loadProducts() {
        const uid = getUIDFromURL()
        
        if (!uid) {
          document.getElementById('productsContainer').innerHTML =
            '<div class="col-12"><p class="text-center text-danger">UID do produtor não encontrado.</p></div>'
          return
        }

        try {
          const productsRef = collection(db, 'products')
          const q = query(productsRef, where('uid', '==', uid)) // Filtrar produtos pelo UID do produtor
          const querySnapshot = await getDocs(q)
          const productsContainer = document.getElementById('productsContainer')

          if (querySnapshot.empty) {
            productsContainer.innerHTML =
              '<div class="col-12"><p class="text-center">Nenhum produto encontrado para este produtor.</p></div>'
          } else {
            querySnapshot.forEach((doc) => {
              const data = doc.data()
              const productCard = `
                <div class="col-md-4 col-sm-6 mb-4">
                  <div class="product-card">
                    <img src="${data.imageURL || 'https://via.placeholder.com/400'}" alt="${data.name}">
                    <div class="product-details">
                      <h5 class="product-title">${data.name}</h5>
                      <p class="product-description">${data.description}</p>
                      <p class="product-price">R$ ${data.price.toFixed(2).replace('.', ',')}</p>
                    </div>
                  </div>
                </div>
              `
              productsContainer.innerHTML += productCard
            })
          }
        } catch (error) {
          console.error('Erro ao carregar produtos:', error)
          document.getElementById('productsContainer').innerHTML =
            '<div class="col-12"><p class="text-center text-danger">Erro ao carregar produtos.</p></div>'
        }
      }

      // Carregar os produtos ao iniciar
      loadProducts()
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
